- platform: template
  sensors:
    ha_sync_status:
      friendly_name: "HA Sync Status"
      value_template: >
        {% set cloud = states('cloud.cloud') %}
        {% set remote = is_state('binary_sensor.remote_ui', 'on') %}
        {% set logged_in = is_state('binary_sensor.cloud_logged_in', 'on') %}
        {% set ai_healthy = is_state('input_boolean.ai_sync_healthy', 'on') %}
        {% if cloud == 'connected' and remote and logged_in and ai_healthy %}
          âœ… Fully Synced
        {% elif cloud == 'connected' and remote and logged_in %}
          ðŸ”„ Cloud Connected
        {% elif cloud == 'connected' %}
          âš ï¸ Limited Sync
        {% else %}
          âŒ Offline Mode
        {% endif %}
      icon_template: >
        {% set cloud = states('cloud.cloud') %}
        {% set remote = is_state('binary_sensor.remote_ui', 'on') %}
        {% set logged_in = is_state('binary_sensor.cloud_logged_in', 'on') %}
        {% if cloud == 'connected' and remote and logged_in %}
          mdi:cloud-sync
        {% elif cloud == 'connected' %}
          mdi:cloud-check
        {% else %}
          mdi:cloud-off
        {% endif %}
      attribute_templates:
        cloud_status: "{{ states('cloud.cloud') }}"
        remote_ui: "{{ is_state('binary_sensor.remote_ui', 'on') }}"
        cloud_logged_in: "{{ is_state('binary_sensor.cloud_logged_in', 'on') }}"
        ai_sync_healthy: "{{ is_state('input_boolean.ai_sync_healthy', 'on') }}"
        last_checked: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"

    system_load_status:
      friendly_name: "System Load Status"
      value_template: >
        {% set load = states('sensor.load_1m') | float(0) %}
        {% if load < 1.0 %}
          Low
        {% elif load < 2.0 %}
          Normal
        {% else %}
          High
        {% endif %}
      icon_template: mdi:speedometer

    ai_merge_last_status:
      friendly_name: "AI Merge Last Status"
      value_template: >
        {% if is_state('input_boolean.validation_passed', 'on') %}
          Success
        {% else %}
          Pending
        {% endif %}
      icon_template: >
        {% if is_state('input_boolean.validation_passed', 'on') %}
          mdi:check-circle
        {% else %}
          mdi:clock-outline
        {% endif %}

    workspace_sync_status:
      friendly_name: "Workspace Sync Status"
      value_template: >
        {% if is_state('input_boolean.ai_workspace_active', 'on') %}
          Active
        {% else %}
          Inactive
        {% endif %}
      icon_template: mdi:folder-sync

    yaml_validation_status:
      friendly_name: "YAML Validation Status"
      value_template: >
        {% if is_state('input_boolean.validation_passed', 'on') %}
          Passed
        {% else %}
          Unknown
        {% endif %}
      icon_template: >
        {% if is_state('input_boolean.validation_passed', 'on') %}
          mdi:check-decagram
        {% else %}
          mdi:help-circle
        {% endif %}

    session_tracking_status:
      friendly_name: "Session Tracking Status"
      value_template: >
        {% if is_state('input_boolean.session_tracking_enabled', 'on') %}
          Enabled
        {% else %}
          Disabled
        {% endif %}
      icon_template: mdi:timeline-clock

    dashboard_log_status:
      friendly_name: "Dashboard Log Status"
      value_template: >
        {% set notes = states('input_text.ai_session_notes') %}
        {% if notes and notes != 'unknown' and notes != '' %}
          Active
        {% else %}
          Empty
        {% endif %}
      icon_template: mdi:file-document

    ai_agent_health:
      friendly_name: "AI Agent Health"
      value_template: >
        {% set healthy_count = [
          is_state('input_boolean.ai_sync_healthy', 'on'),
          is_state('input_boolean.validation_passed', 'on'),
          is_state('input_boolean.ai_workspace_active', 'on')
        ] | select('true') | list | length %}
        {% if healthy_count == 3 %}
          Excellent
        {% elif healthy_count == 2 %}
          Good
        {% elif healthy_count == 1 %}
          Fair
        {% else %}
          Poor
        {% endif %}
      icon_template: >
        {% set healthy_count = [
          is_state('input_boolean.ai_sync_healthy', 'on'),
          is_state('input_boolean.validation_passed', 'on'),
          is_state('input_boolean.ai_workspace_active', 'on')
        ] | select('true') | list | length %}
        {% if healthy_count == 3 %}
          mdi:emoticon-excited
        {% elif healthy_count == 2 %}
          mdi:emoticon-happy
        {% elif healthy_count == 1 %}
          mdi:emoticon-neutral
        {% else %}
          mdi:emoticon-sad
        {% endif %}

# Modular AI Monitoring Sensors for Home Assistant
- platform: template
  sensors:
    hacs_status:
      friendly_name: "HACS Integration Health"
      value_template: >
        {{ 'ok' if is_state('sensor.hacs', 'on') else 'problem' }}
      icon_template: mdi:package-variant-closed
    zigbee_mesh_lqi:
      friendly_name: "Zigbee Mesh LQI"
      value_template: >
        {{ states('sensor.zigbee2mqtt_networkmap_lqi') | int(0) }}
      icon_template: mdi:router-wireless
    mqtt_status:
      friendly_name: "MQTT Broker Status"
      value_template: >
        {{ 'online' if is_state('binary_sensor.mqtt_broker', 'on') else 'offline' }}
      icon_template: mdi:transit-connection
    automation_health:
      friendly_name: "Automation Health"
      value_template: >
        {{ states('sensor.watchman_disabled_automations') | int(0) == 0 and 'ok' or 'issues' }}
      icon_template: mdi:robot
    watchman_orphans:
      friendly_name: "Orphaned Entities"
      value_template: >
        {{ states('sensor.watchman_orphaned_entities') | int(0) }}
      icon_template: mdi:account-off