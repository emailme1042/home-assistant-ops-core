---
# -----------------------------------------------
# Lovelace UI Configuration
# -----------------------------------------------

input_boolean: !include_dir_merge_named includes/input_booleans/
input_number: !include_dir_merge_named includes/input_numbers/
input_datetime: !include_dir_merge_named includes/input_datetimes/
input_select: !include_dir_merge_named includes/input_selects/
input_text: !include_dir_merge_named includes/input_texts/
script: !include_dir_merge_named includes/scripts/

template: !include_dir_merge_list includes/templates/
sensor: !include_dir_merge_list includes/sensors/

automation: !include automations.yaml
scene: !include includes/scenes/scenes.yaml

api:

mqtt:

mqtt_statestream: !include mqtt_statestream.yaml  # âœ… Correct placement

python_script:

homeassistant:
  allowlist_external_dirs:
    - www

  allowlist_external_urls:
    - https://api.openai.com/v1/chat/completions
    - https://api.openai.com/v1/models
    - https://api.openai.com/v1/engines

default_config:

shell_command:
  save_email_subject: >
    echo "{{ trigger.event.data.subject | default('No subject') if trigger is defined else 'No trigger' }}" > /config/email/subject.txt
  mount_ai_workspace: "mkdir -p /config/ai_workspace && mount -t cifs -o username={{ secrets.smb_user }},password={{ secrets.smb_pass }} //JD-HOMEOFFICE-PC/AI_WORKSPACE /config/ai_workspace"
  validate_yaml: 'python3 /config/scripts/validate_yaml.py > /config/fix_sheet.yaml && echo "$(date)" >> /config/fix_sheet.yaml'

  run_ha_sync: 'ssh emailadmin@172.25.130.31 "bash ~/HA_Samba-Repo/ha_sync.sh"'

  sync_git_to_ha: "bash /config/scripts/git_auto_sync.sh from-git"
  run_gpt_via_flask_local: "curl -X POST http://localhost:5000/run_gpt"

  # ðŸ¤– GPT CORE
  run_generate_yaml_ai: "python3 /config/python_scripts/generate_yaml_ai.py"
  run_deploy_dashboard: "python3 /config/python_scripts/deploy_dashboard.py"
  run_gpt_via_flask: >-
    curl -X POST http://192.168.1.203:5001/run_nas_script
    -H "Content-Type: application/json"
    -d '{"prompt": "{{ prompt }}"}'

  # ðŸ§  GPT SESSION / LOGGING
  write_gpt_response: "echo '{{ response_text | replace(\"'\", \"\\'\") | replace(\"\\n\", \" \") }}' > /config/www/gpt_response.txt"
  run_context_collector: "python3 /config/python_scripts/context_collector.py"
  run_ai_generate_suggestions: "python3 /config/python_scripts/ai_generate_suggestions.py"
  run_chatgpt_user_reply: "python3 /config/python_scripts/chatgpt_user_reply.py '{{ states('input_text.gpt_text_prompt') }}'"
  write_changelog_entry: >
    echo "\n# # # $(date +%Y-%m-%d_%H:%M) - Session Ended: $(cat /config/includes/input_texts/gpt_session.yaml | grep initial | cut -d '"' -f2)" >> /config/www/CHANGELOG.md &&
    cp /config/Master\ Context\ 0717.txt "/config/www/context_snapshots/context_$(date +%Y%m%d_%H%M).md"

  # ðŸ” SYNC + CLEANUP
  cleanup_zone_identifier: "find /config -type f -name '*:Zone.Identifier' -delete"
  git_sync: >
    bash -c "cd ~/home-assistant-dashboards && git pull && git add . &&
    git commit -m 'ðŸ”„ Auto Git Sync - $(date +%F_%T)' || echo 'No changes' &&
    git push || echo 'ðŸ”’ Git push failed â€” check VPN or token'"
  create_git_backup_zip: >
    zip -r /config/www/context_snapshots/backup_$(date +%Y%m%d_%H%M).zip /home/emailadmin/home-assistant-dashboards
  create_marker_file: "touch /startup_marker"
  # ðŸš§ PLACEHOLDER
  run_chatgpt_user: "echo 'placeholder for shell'"

  # run_chatgpt_user: >-
  # sshpass -p "!secret synology_password" ssh -o StrictHostKeyChecking=no -p 5522 admin@192.168.1.2 "/volume1/ha_remote/myvenv/bin/python3 /volume1/ha_remote/chatgpt_user_reply.py '{{ prompt }}'"
  # run_orchestrator_ai_ops: "python3 /config/python_scripts/orchestrator_ai_ops.py"

  # ðŸ“§ EMAIL HANDLING
  write_email_subject: >
    echo "{{ trigger.event.data.subject | default('No subject') | replace('"', "'") }}"
    > /config/email/subject.txt

  write_email_body: >
    echo "{{ trigger.event.data.text | default('No body') | truncate(1000) | replace('"', "'") }}"
    > /config/email/body.txt

  write_email_from: >
    echo "{{ trigger.event.data.from | default('Unknown sender') | replace('"', "'") }}"
    > /config/email/from.txt

logger:
  default: warning
  logs:
    custom_components.your_component: debug
    homeassistant.components.script: info
    homeassistant.components.automation: info
    homeassistant.components.bluetooth: debug
    homeassistant.components.bluetooth.manager: warning

notify:
  - name: gmail_smtp
    platform: smtp
    server: smtp.gmail.com
    port: 587
    encryption: starttls
    sender: !secret gmail_sender
    recipient:
      - !secret gmail_recipient
    username: !secret gmail_username
    password: !secret gmail_password
    sender_name: "Home Assistant"

# # =========================
# # Future REST Commands for Planned APIs
# # =========================

rest_command:
  #   # Dropbox Sync
  #   dropbox_upload:
  #     url: "https://content.dropboxapi.com/2/files/upload"
  #     method: POST
  #     headers:
  #       Authorization: "Bearer {{ secrets.dropbox_token }}"
  #       Content-Type: "application/octet-stream"
  #       Dropbox-API-Arg: '{"path": "/HA_Uploads/{{ filename }}", "mode": "add", "autorename": true, "mute": false}'
  #     payload: "{{ file_content }}"

  #   # OpenAI Embeddings API
  #   openai_embed:
  #     url: "https://api.openai.com/v1/embeddings"
  #     method: POST
  #     headers:
  #       Authorization: "Bearer {{ secrets.openai_embed_key }}"
  #       Content-Type: "application/json"
  #     payload: >
  #       {
  #         "model": "text-embedding-3-large",
  #         "input": "{{ text_input }}"
  #       }

  #   # Azure Computer Vision
  #   azure_cv:
  #     url: "https://<your-region>.api.cognitive.microsoft.com/vision/v3.2/analyze?visualFeatures=Categories,Description,Color"
  #     method: POST
  #     headers:
  #       Ocp-Apim-Subscription-Key: "{{ secrets.azure_cv_token }}"
  #       Content-Type: "application/octet-stream"
  #     payload: "{{ image_data }}"

  #   # Google Cloud TTS
  #   google_tts:
  #     url: "https://texttospeech.googleapis.com/v1/text:synthesize"
  #     method: POST
  #     headers:
  #       Authorization: "Bearer {{ secrets.tts_google_key }}"
  #       Content-Type: "application/json"
  #     payload: >
  #       {
  #         "input": {"text": "{{ tts_text }}"},
  #         "voice": {"languageCode": "en-US", "name": "en-US-Wavenet-D"},
  #         "audioConfig": {"audioEncoding": "MP3"}
  #       }

  #   # Notion API (Update Page)
  #   notion_update:
  #     url: "https://api.notion.com/v1/pages"
  #     method: PATCH
  #     headers:
  #       Authorization: "Bearer {{ secrets.notion_token }}"
  #       Content-Type: "application/json"
  #       Notion-Version: "2022-06-28"
  #     payload: "{{ notion_payload }}"

  nas_backup_now:
    url: "http://192.168.1.100:5000/backup/start"
    method: POST

  external_webhook_trigger:
    url: "https://example.com/webhook"
    method: POST
    payload: '{"data": "triggered from HA"}'
    content_type: "application/json"

  ask_openai:
    url: "https://api.openai.com/v1/chat/completions"
    method: POST
    headers:
      Authorization: "Bearer !secret openai_api_key"
      Content-Type: "application/json"
    payload: >
      {
        "model": "gpt-4o",
        "messages": [
          {
            "role": "user",
            "content": "{{ prompt | default('Hello GPT') }}"
          }
        ],
        "temperature": 0.7
      }

    content_type: "json"

  jit_plugin_call:
    url: "http://127.0.0.1:5001/jit_plugin/{{ endpoint }}"
    method: POST
    content_type: "application/json"
    payload: "{{ payload }}"

  jit_get_file_contents:
    url: "http://192.168.1.203:5001/jit_plugin/get_file_contents?path={{ path }}"
    method: get

  jit_list_folder:
    url: >-
      http://192.168.1.203:5001/jit_plugin/list_folder?path={{ path }}
    method: GET

  run_nas_script:
    url: "http://127.0.0.1:5005/run_nas_script"
    method: post
    headers:
      Content-Type: application/json
    payload: '{"prompt":"{{ prompt }}"}'

  run_git_sync:
    url: "http://192.168.1.203:5005/run_sync"
    method: POST

tts:
  - platform: google_translate
    service_name: google_say

# scan_ha_folders: "python3 /config/python_scripts/scan_ha_folders.py" not req as ai system uses snapshots and states - no longer relevant..
# /config/python_scripts/cleanup_backups.py
# print("This would be your backup cleanup logic (e.g., delete old files).")

lovelace:
  mode: yaml  # keeps your existing UI dashboards intact
  resources: !include resources.yaml

  dashboards:
    ai-workspace:
      mode: yaml
      title: AI Workspace
      icon: mdi:robot
      show_in_sidebar: true
      filename: dashboards/ai-workspace.yaml

    starter-recovery:
      mode: yaml
      title: Recovery
      icon: mdi:heart-pulse
      show_in_sidebar: true
      filename: dashboards/starter_recovery_dashboard.yaml

    test-sync:
      mode: yaml
      title: AI Sync Test
      icon: mdi:robot
      show_in_sidebar: true
      filename: dashboards/sync-test.yaml

    ops-todo:
      mode: yaml
      title: TODO & Next Actions
      icon: mdi:check-circle
      show_in_sidebar: true
      filename: dashboards/ops/todo-dashboard.yaml


    admin-dash:
      mode: yaml
      title: Admin
      icon: mdi:tools
      show_in_sidebar: true
      filename: dashboards/admin/main.yaml

    user-dash:
      mode: yaml
      title: User
      icon: mdi:account
      show_in_sidebar: true
      filename: dashboards/users/main.yaml

    user-dashboard:
      mode: yaml
      title: User Home
      icon: mdi:account-home
      show_in_sidebar: true
      filename: dashboards/users/user_dashboard.yaml

    network-diagnostics:
      mode: yaml
      title: Network
      icon: mdi:lan
      show_in_sidebar: true
      filename: dashboards/admin/network_diagnosis.yaml

    fire-tv:
      mode: yaml
      title: Fire TV Remote
      icon: mdi:remote-tv
      show_in_sidebar: true
      filename: dashboards/users/fire_tv.yaml

    teddy-central:
      mode: yaml
      title: Teddy Central
      icon: mdi:teddy-bear
      show_in_sidebar: true
      filename: dashboards/users/teddy_central.yaml

    home-dashboard:
      mode: yaml
      title: Home
      icon: mdi:home-outline
      show_in_sidebar: true
      filename: dashboards/users/home.yaml

    ops-dash:
      mode: yaml
      title: Ops
      icon: mdi:calendar-check
      show_in_sidebar: true
      filename: dashboards/ops/main.yaml

    admin-batch1:
      mode: yaml
      title: ðŸ§© Admin Batch 1
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch1.yaml

    admin-batch2:
      mode: yaml
      title: ðŸ§© Admin Batch 2
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch2.yaml

    admin-batch3:
      mode: yaml
      title: ðŸ§© Admin Batch 3
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch3.yaml

    admin-batch4:
      mode: yaml
      title: ðŸ§© Admin Batch 4
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch4.yaml

    admin-batch5:
      mode: yaml
      title: ðŸ§© Admin Batch 5
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch5.yaml

    admin-batch6:
      mode: yaml
      title: ðŸ§© Admin Batch 6
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch6.yaml

    admin-batch7:
      mode: yaml
      title: ðŸ§© Admin Batch 7
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch7.yaml

    admin-batch8:
      mode: yaml
      title: ðŸ§© Admin Batch 8
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch8.yaml

    admin-batch9:
      mode: yaml
      title: ðŸ§© Admin Batch 9
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch9.yaml

    admin-batch10:
      mode: yaml
      title: ðŸ§© Admin Batch 10
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch10.yaml

    admin-batch11:
      mode: yaml
      title: ðŸ§© Admin Batch 11
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch11.yaml

    admin-batch12:
      mode: yaml
      title: ðŸ§© Admin Batch 12
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch12.yaml

    admin-batch13:
      mode: yaml
      title: ðŸ§© Admin Batch 13
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch13.yaml

    admin-batch14:
      mode: yaml
      title: ðŸ§© Admin Batch 14
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch14.yaml

    admin-batch15:
      mode: yaml
      title: ðŸ§© Admin Batch 15
      icon: mdi:view-dashboard-outline
      show_in_sidebar: false
      filename: dashboards/admin/admin_partials_batch15.yaml
